!function(a){"use strict";var b=window.GEM||{};b.DEBUG_FLAG=!0,b.init=function(){a("form.gem-form").submit(function(c){var d,e,f,g,h,i=a(this),j=a(".gem-spinner",i),k=i.find(".gem-error, .gem-info"),l=[],m=[];c.preventDefault(),a(this).find("input[type=checkbox]").each(function(){var b=a(this),c=b.data("name");e!==c&&(e=c,f=a('input:checkbox[data-name="'+c+'"]:checked').map(function(){return this.value}).get().join(", "),a('input[name="'+c+'"]').val(f))}),a(this).find("[fingerprint=date]").each(function(){var b=a(this),c=b.data("name");g!==c&&(g=c,a('select[data-name="'+c+'"]').each(function(){var b=a(this).val();b&&m.push(b)}),3===m.length&&(h=m[0]+" "+m[1]+", "+m[2],a('input[name="'+c+'"]').val(h)))}),d=a(this).serialize(),i.find("input.gem-invalid").removeClass("gem-invalid"),a(this).find(".gem-required").each(function(){var c=a(this).val();"signup[email]"!==a(this).attr("name")||b.isEmail(c)?""===c&&a(this).is("input")?l.push(a(this)):a(this).is("label")&&"undefined"==typeof a('input:radio[name="'+a(this).data("name")+'"]:checked').val()&&l.push(a(this)):l.push(a(this))}),0===l.length?(j.css("display","inline-block"),a.post(i.attr("action")+".json",d,function(a){i.fadeOut("fast",function(){var c;a.success?(c=a.result.audience_member.suppressed,a.result.has_redirect&&(window.location.href=a.result.redirect),i.html(b.addMessage(c?["suppressed","success"]:["info","success"],c?b.thankyou_suppressed:b.thankyou)).fadeIn("fast")):i.html(b.addMessage("info",b.oops)).fadeIn("fast")})},"jsonp")):(0!==k.length&&k.remove(),a(l.reverse()).each(function(){var c="";a(this).addClass("gem-invalid"),"signup[email]"===a(this).attr("name")?c=""===a(this).val()?b.required.replace("%s",a(this).data("label")):b.email:a(this).data("label")&&(c=b.required.replace("%s",a(this).data("label"))),c&&i.prepend(b.addMessage("error",c))}))})},b.addMessage=function(b,c){var d=[];return a.isArray(b)?a.each(b,function(a,b){d.push("gem-"+b)}):d.push("gem-"+b.toString()),a("<p/>",{class:d.join(" ")}).text(c)},b.isEmail=function(a){var b=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)},a(document).ready(b.init)}(jQuery);