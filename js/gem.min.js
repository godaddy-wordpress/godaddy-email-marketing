!function(e){"use strict";var a=window.GEM||{};a.DEBUG_FLAG=!0,a.init=function(){e("form.gem-form").submit(function(i){var t,s,n,r,u,d=e(this),h=e(".gem-spinner",d),c=d.find(".gem-error, .gem-info"),o=[],l=[];i.preventDefault(),e(this).find("input[type=checkbox]").each(function(){var a=e(this).data("name");s!==a&&(s=a,n=e('input:checkbox[data-name="'+a+'"]:checked').map(function(){return this.value}).get().join(", "),e('input[name="'+a+'"]').val(n))}),e(this).find("[fingerprint=date]").each(function(){var a=e(this).data("name");r!==a&&(r=a,e('select[data-name="'+a+'"]').each(function(){var a=e(this).val();a&&l.push(a)}),3===l.length&&(u=l[0]+" "+l[1]+", "+l[2],e('input[name="'+a+'"]').val(u)))}),t=e(this).serialize(),d.find("input.gem-invalid").removeClass("gem-invalid"),e(this).find(".gem-required").each(function(){var i=e(this).val();"signup[email]"!==e(this).attr("name")||a.isEmail(i)?""===i&&e(this).is("input")?o.push(e(this)):e(this).is("label")&&void 0===e('input:radio[name="'+e(this).data("name")+'"]:checked').val()&&o.push(e(this)):o.push(e(this))}),0===o.length?(h.css("display","inline-block"),e.post(d.attr("action")+".json",t,function(e){d.fadeOut("fast",function(){var i;e.success?(i=e.result.audience_member.suppressed,e.result.has_redirect&&(window.location.href=e.result.redirect),d.html(a.addMessage(i?["suppressed","success"]:["info","success"],i?a.thankyou_suppressed:a.thankyou)).fadeIn("fast")):d.html(a.addMessage("info",a.oops)).fadeIn("fast")})},"jsonp")):(0!==c.length&&c.remove(),e(o.reverse()).each(function(){var i="";e(this).addClass("gem-invalid"),"signup[email]"===e(this).attr("name")?i=""===e(this).val()?a.required.replace("%s",e(this).data("label")):a.email:e(this).data("label")&&(i=a.required.replace("%s",e(this).data("label"))),i&&d.prepend(a.addMessage("error",i))}))})},a.addMessage=function(a,i){var t=[];return e.isArray(a)?e.each(a,function(e,a){t.push("gem-"+a)}):t.push("gem-"+a.toString()),e("<p/>",{class:t.join(" ")}).text(i)},a.isEmail=function(e){return/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},e(document).ready(a.init)}(jQuery);