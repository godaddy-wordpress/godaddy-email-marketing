!function(e){"use strict";var i=window.GEM||{};i.DEBUG_FLAG=!0,i.init=function(){e("form.gem-form").submit(function(t){var a,s,n,r,u,h=e(this),c=e(".gem-spinner",h),d=h.find(".gem-error, .gem-info"),o=[],l=[];t.preventDefault(),e(this).find("input[type=checkbox]").each(function(){var i=e(this).data("name");s!==i&&(s=i,n=e('input:checkbox[data-name="'+i+'"]:checked').map(function(){return this.value}).get().join(", "),e('input[name="'+i+'"]').val(n))}),e(this).find("[fingerprint=date]").each(function(){var i=e(this).data("name");r!==i&&(r=i,e('select[data-name="'+i+'"]').each(function(){var i=e(this).val();i&&l.push(i)}),3===l.length&&(u=l[0]+" "+l[1]+", "+l[2],e('input[name="'+i+'"]').val(u)))}),a=e(this).serialize(),h.find("input.gem-invalid").removeClass("gem-invalid"),e(this).find(".gem-required").each(function(){var t=e(this).val();"signup[email]"!==e(this).attr("name")||i.isEmail(t)?""===t&&e(this).is("input")?o.push(e(this)):e(this).is('input[type="checkbox"]')&&!e(this).is(":checked")?o.push(e(this)):e(this).is("label")&&void 0===e('input:radio[name="'+e(this).data("name")+'"]:checked').val()&&o.push(e(this)):o.push(e(this))}),0===o.length?(c.css("display","inline-block"),e.post(h.attr("action")+".json",a,function(e){h.fadeOut("fast",function(){var t;e.success?(t=e.result.audience_member.suppressed,e.result.has_redirect&&(window.location.href=e.result.redirect),h.html(i.addMessage(t?["suppressed","success"]:["info","success"],t?i.thankyou_suppressed:i.thankyou)).fadeIn("fast")):h.html(i.addMessage("info",i.oops)).fadeIn("fast")})},"jsonp")):(0!==d.length&&d.remove(),e(o.reverse()).each(function(){var t="";e(this).addClass("gem-invalid"),"signup[email]"===e(this).attr("name")?t=""===e(this).val()?i.required.replace("%s",e(this).data("label")):i.email:e(this).data("label")&&(t=i.required.replace("%s",e(this).data("label"))),t&&h.prepend(i.addMessage("error",t))}))})},i.addMessage=function(i,t){var a=[];return e.isArray(i)?e.each(i,function(e,i){a.push("gem-"+i)}):a.push("gem-"+i.toString()),e("<p/>",{class:a.join(" ")}).text(t)},i.isEmail=function(e){return/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},e(document).ready(i.init)}(jQuery);